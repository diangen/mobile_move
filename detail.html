<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>详情</title>
  <link rel="stylesheet" href="css/swiper.min.css">
  <link rel="stylesheet" href="./css/reset.css">
  <link rel="stylesheet" href="./font/iconfont.css">
  <link rel="stylesheet" href="./css/detail.css">
  <style>
    /* 无缝滚动样式 */
    /* 本例子css */
    .picMarquee-left {
      overflow: hidden;
      position: relative;
      border: 1px solid #ccc;
    }

    .picMarquee-left .bd {
      padding: 0.1333rem;
    }

    .picMarquee-left .bd ul {
      overflow: hidden;
      zoom: 1;
    }

    .picMarquee-left .bd ul li {
      margin: 0 0.1067rem;
      float: left;
      _display: inline;
      overflow: hidden;
      text-align: center;
    }

    .picMarquee-left .bd ul li .pic {
      text-align: center;
    }

    .picMarquee-left .bd ul li .pic img {
      width: 1.6rem;
      height: 2rem;
      display: block;
      padding: 0.0267rem;
      border: 1px solid #ccc;
    }

    .picMarquee-left .bd ul li .pic a:hover img {
      border-color: #999;
    }

    .picMarquee-left .bd ul li .title {
      line-height: 0.32rem;
      font-size: 0.3133rem;
      margin: .2rem 0;
    }

    .picMarquee-left .bd .tempWrap {
      width: 100% !important;
    }
  </style>

<body>
  <div class="nav">
    <span id="back" class="iconfont icon-xiangzuo-copy"></span>
    <h2 class="tit">电影详情</h2>
    <span></span>
  </div>
  <div class="banner" id="detaiBanner">
  </div>
  <div class="content" id="content">
  </div>
  <!-- 评论 -->
  <div class="comment" id="comment">
  </div>

</body>
<script src="./js/jquery-1.8.3.js"></script>


<script src="./js/flexible.js"></script>
<script src="./js/common.js"></script>

<script>


  // 获取url中传参id
  function GetRequest() {
    var url = location.search; //获取url中"?"符后的字串
    var theRequest = new Object();
    if (url.indexOf("?") != -1) {
      var str = url.substr(1);
      strs = str.split("&");
      for (var i = 0; i < strs.length; i++) {
        theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
      }
    }
    return theRequest;
  }

  let id = '';
  let value = '';
  let a = GetRequest();
  for (const key in a) {
    id = key
    value = a[key];
  }

  $.ajax({
    type: "GET",
    url: "http://localhost:8080/movie-api/movie/getById.do?id=" + id,
    // dataType: 'json',
    success: function (response) {
      console.log(response)
      if (response.code = 100) {
        // Str(response.data)
      }
    }
  });

  function Str(data) {
    console.log(data)
    let hotStr = '<h3>' + hot.title + '</h3>'
      + '<p><span>主演:</span>' + hot.star + '</p>'
      + '<p><span>上映时间:</span>' + hot.time + '</p>'
      + '<div class="ping" id="ping"><p class="score"><span>评分:</span></p>'
      + '<div class="rate"><div class="rating" id="rating">'
      + '<div class="rating-item"></div>'
      + '<div class="rating-item"></div>'
      + '<div class="rating-item"></div>'
      + '<div class="rating-item"></div>'
      + '<div class="rating-item"></div>'
      + '<div class="rating-item"></div>'
      + '<div class="rating-item"></div>'
      + '<div class="rating-item"></div>'
      + '<div class="rating-item"></div>'
      + '<div class="rating-item"></div>'
      + '</div>'
      + '</div></div>'
      + '<p><span>电影口碑:</span>' + hot.reputation + '</p>'
      + '<p><span>电影详情:</span>' + hot.deatil + '</p>'
      + '<div><p><span>演员介绍:</span></p>'
      + '<div class="picMarquee-left" >'
      + '<div class="bd">'
      + '<ul class="picList" id="picListDemo">'
      + '</ul></div>'
      + '</div>'
    let bannerStr = '<img src=' + hot.imgDeatil + ' alt="">'
    $("#detaiBanner").append(bannerStr)
    $("#content").append(hotStr)

    pingfen(hot.score)
    // 动态实现评论（事件委托）
    $("#rating").on('mouseover', '.rating-item', function () {
      pingfen($(this).index() + 1)
    }).on('mouseout', '.rating-item', function () {
      pingfen(hot.score)
    }).on('click', '.rating-item', function () {
      hot.score = $(this).index() + 1
    })
    noswiper(hot);
    pingjia(hot.evaluate)
  }
  // 判断点击界面详情
  // function detailValue(data) {
  //   if ("hot_id" == id) {
  //     Str(data.hot, id)
  //   } else if ("expect_id" == id) {
  //     Str(data.expect, id)
  //   } else if ("list_id" == id) {
  //     Str(data.list, id)
  //   }
  // }
  // // 回调函数返回数据
  // function dataJson(data) {
  //   detailValue(data.move)
  // }
  //  无缝链接图片
  function noswiper(data) {
    let picStr = '';
    $.each(data.avater, function (index, data) {
      picStr += '<li>'
        + '<div class="pic"><a href="#" target="_blank"><img style="width:100px;" src=' + data.imgUrl + ' /></a>'
        + '</div>'
        + '<div class="title"><a href="#" target="_blank">' + data.title + '</a></div>'
        + '</li>'
    })
    $("#picListDemo").append(picStr)
  }
  $("#back").click(function () {
    window.history.back()
  })
  // 评分
  function pingfen(num) {
    $("#rating").find(".rating-item").each(function (index, data) {
      $('#rating').find('.rating-item').each(function (index) {
        if (index < Math.floor(num)) {
          $(this).css('background-position', '0 0')
        } else {
          $(this).css('background-position', '-21px 0')
        }
      })
    })
  }
  // 评价
  function pingjia(data) {
    let speakStr = '';
    $.each(data, function (index, data) {
      speakStr += ' <div class="commetn-item"><div class="avater"><img src=' + data.avater + ' alt=""></div>'
        + '<div class="left">'
        + '<div class="title">'
        + '<p>' + data.title + '</p>'
        + '<p>' + data.time + '</p>'
        + '<p><span>评价：</span>'
        + data.speak
        + '</div>'
        + '</div> </div>'
    })
    $("#comment").append(speakStr)
  }


</script>


<script src="./js/jquery.SuperSlide.2.1.3.js"></script>
<script type="text/javascript">
  $(".picMarquee-left").slide({
    mainCell: ".bd ul",
    autoPlay: true,
    effect: "leftMarquee",
    vis: 3,
    interTime: 50
  });
</script>

</html>